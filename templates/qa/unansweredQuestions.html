{% extends 'profile/base.html' %}
{% load humanize %}
{% load static %}
{% load qa_tags %}

{% block css %}
<style>
    /* --- Base Variables and Body Style --- */
    :root {
      --primary: #6366f1;
      --primary-light: #818cf8;
      --primary-dark: #4f46e5;
      --text-primary: #1e293b;
      --text-secondary: #64748b;
      --bg-primary: #ffffff;
      --bg-secondary: #f1f5f9;
      --border: #e2e8f0;
      --hover: #f1f5f9;
    }

    body.questions-page {
      background: var(--bg-secondary) !important;
      font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', sans-serif;
      color: var(--text-primary);
      line-height: 1.6;
      font-size: 15px;
    }

    .container {
        max-width: 1400px;
        margin: 0 auto;
        background: transparent !important;
        box-shadow: none !important;
    }

    /* --- Main Content Area --- */
    #content { 
        background-color: var(--bg-secondary); 
        min-height: calc(100vh - 100px);
        width: 100%;
        max-width: 100%;
    }

    #mainbar { 
        padding: 24px; 
        flex-grow: 1; 
        min-width: 0;
        width: 100%;
        max-width: 100%;
    }

    .fs-headline1 { 
        font-size: 32px; 
        font-weight: 700; 
        color: var(--text-primary); 
        letter-spacing: -0.5px; 
    }

    /* --- Ask Question Button --- */
    .s-btn__primary {
        background: var(--primary) !important;
        color: white !important;
        border: none !important;
        padding: 10px 16px !important;
        border-radius: 8px !important;
        font-weight: 500 !important;
        font-size: 15px !important;
        transition: all 0.2s !important;
        box-shadow: none !important;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        text-decoration: none;
    }

    .s-btn__primary:hover { 
        background: var(--primary-dark) !important; 
        transform: translateY(-1px); 
    }

    /* --- Filter Button Group --- */
    .s-btn-group { 
        gap: 0px !important; 
        border-radius: 8px; 
        overflow: hidden; 
        display: inline-flex; 
    }

    .s-btn-group .s-btn__sm {
        border: 1px solid var(--border) !important;
        background: white !important;
        color: var(--text-secondary) !important;
        padding: 6px 14px !important;
        font-size: 14px !important;
        font-weight: 500 !important;
        transition: all 0.2s !important;
        margin: 0 !important;
        border-radius: 0 !important;
    }

    .s-btn-group .s-btn__sm:hover { 
        border-color: var(--primary) !important; 
        color: var(--primary) !important; 
    }

    .s-btn-group .is-selected { 
        background: var(--primary) !important; 
        color: white !important; 
        border-color: var(--primary) !important; 
        z-index: 2; 
    }

    .s-btn-group > .s-btn__sm:first-child { 
        border-top-left-radius: 8px !important; 
        border-bottom-left-radius: 8px !important; 
    }

    .s-btn-group > .s-btn__sm:last-child { 
        border-top-right-radius: 8px !important; 
        border-bottom-right-radius: 8px !important; 
    }

    .s-btn-group > .s-btn__sm:not(:first-child) { 
        border-left-width: 0 !important; 
    }

    .s-badge__bounty { 
        background-color: #f472b6; 
        color: white; 
        border-radius: 4px; 
    }

    /* --- Question Summary Card Styles --- */
    .question-summary {
        background: var(--bg-primary) !important;
        border: 1px solid var(--border) !important;
        border-radius: 12px !important;
        padding: 24px !important;
        margin-bottom: 16px !important;
        transition: all 0.2s ease-out !important;
        display: flex !important;
        gap: 20px;
        width: 100%;
        max-width: 100%;
    }

    .question-summary:hover {
        border-color: var(--primary) !important;
        box-shadow: 0 6px 16px rgba(99, 102, 241, 0.15);
        transform: translateY(-3px);
    }

    .statscontainer {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 12px;
        flex-shrink: 0;
        width: 70px;
    }

    .statscontainer .stats { 
        display: flex; 
        flex-direction: column; 
        align-items: center; 
        gap: 8px; 
        width: 100%;
    }

    .statscontainer .votes, 
    .statscontainer .status, 
    .statscontainer .views {
        text-align: center;
        color: var(--text-secondary);
        font-size: 13px;
        line-height: 1.2;
        padding: 0 !important;
        background: transparent !important;
        border: none !important;
        min-width: 0 !important;
    }

    .statscontainer strong, 
    .statscontainer .vote-count-post {
        display: block;
        font-size: 18px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 2px;
    }

    .statscontainer .votes strong { 
        color: var(--primary) !important; 
    }

    .statscontainer .status.answered strong,
    .statscontainer .status.answered-accepted strong { 
        color: #10b981 !important; 
    }

    .statscontainer .status.answered-accepted {
       background-color: #d1fae5 !important;
       color: #065f46 !important;
       border: 1px solid #6ee7b7 !important;
       border-radius: 6px !important;
       padding: 6px 8px !important;
       width: 100%;
   }

    .statscontainer .status.answered-accepted strong { 
        color: #065f46 !important; 
    }

    .statscontainer .views { 
        margin-top: auto; 
    }

    .summary { 
        flex-grow: 1; 
        min-width: 0; 
    }

    .summary h3 { 
        margin: 0 0 8px 0; 
    }

    .summary .question-hyperlink {
        color: var(--text-primary) !important;
        font-size: 18px !important;
        font-weight: 600 !important;
        text-decoration: none !important;
        line-height: 1.4 !important;
        transition: color 0.2s !important;
    }

    .summary .question-hyperlink:hover {
        color: var(--primary) !important;
    }

    .summary .excerpt {
        color: var(--text-secondary);
        font-size: 14px;
        line-height: 1.6;
        margin-bottom: 12px;
    }

    .summary .tags {
        margin-bottom: 12px;
    }

    .summary .post-tag {
        background: #eef2ff !important;
        color: #4338ca !important;
        border: 1px solid #c7d2fe !important;
        padding: 4px 10px !important;
        border-radius: 6px !important;
        font-size: 13px !important;
        font-weight: 500 !important;
        text-decoration: none !important;
        transition: all 0.2s !important;
        display: inline-block;
    }

    .summary .post-tag:hover {
        background: var(--primary) !important;
        color: white !important;
        border-color: var(--primary) !important;
    }

    .summary .started {
        display: flex;
        align-items: center;
        justify-content: flex-end;
        gap: 8px;
        margin-top: 8px;
    }

    .summary .user-info { 
        display: flex; 
        align-items: center; 
        gap: 8px; 
    }

    .summary .user-gravatar32 { 
        width: 32px; 
        height: 32px; 
        flex-shrink: 0;
    }

    .summary .user-gravatar32 img { 
        border-radius: 50%; 
        width: 100%; 
        height: 100%; 
        object-fit: cover; 
    }

    .summary .user-details { 
        font-size: 13px; 
        line-height: 1.3; 
    }

    .summary .user-details a { 
        color: var(--primary); 
        text-decoration: none; 
        font-weight: 500; 
    }

    .summary .user-details a:hover { 
        text-decoration: underline; 
    }

    .summary .user-action-time { 
        color: var(--text-secondary); 
        margin-left: auto; 
        padding-left: 10px; 
        font-size: 13px; 
    }

    .summary .reputation-score {
        background: var(--bg-secondary);
        color: var(--text-secondary);
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 600;
        margin: 0 4px;
    }

    .summary .user-details .badge1::before { 
        content: "●"; 
        color: #ffcc01; 
        margin-right: 2px; 
    }

    .summary .user-details .badge2::before { 
        content: "●"; 
        color: #b4b8bc; 
        margin-right: 2px; 
    }

    .summary .user-details .badge3::before { 
        content: "●"; 
        color: #d1a684; 
        margin-right: 2px; 
    }

    .summary .user-details .badgecount { 
        font-size: 12px; 
        color: var(--text-secondary); 
    }

    #questions {
        width: 100%;
        max-width: 100%;
    }

    /* --- Pagination --- */
    .s-pagination { 
        display: flex; 
        justify-content: flex-start; 
        gap: 4px; 
        margin-top: 24px; 
    }

    .s-pagination--item {
        color: var(--text-secondary);
        background-color: var(--bg-primary);
        border: 1px solid var(--border);
        padding: 6px 12px;
        border-radius: 6px;
        text-decoration: none;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.2s;
    }

    .s-pagination--item:hover {
        border-color: var(--primary);
        color: var(--primary);
    }

    .s-pagination--item.is-selected {
        background-color: var(--primary);
        color: white;
        border-color: var(--primary);
    }
</style>
{% endblock css %}

{% block content %}
<div id="content" class="snippet-hidden">
    <div id="mainbar" role="main" aria-labelledby="h-all-questions">
            <div class="d-flex ai-center jc-space-between mb24">
                <h1 class="fs-headline1">All Questions</h1>
                <a href="{% url 'qa:new_question' %}" class="s-btn s-btn__primary">Ask Question</a>
            </div>

            <div data-controller="se-uql" data-se-uql-id="" data-se-uql-sanitize-tag-query="false">
                <div class="d-flex ai-center jc-space-between mb12 sm:fd-column sm:ai-stretch">
                    <div class="fs-body3 flex--item fl1 mr12 sm:mr0 sm:mb12">
                        {{questionsCount}}
                        question{{questionsCount|pluralize}}
                    </div>

                    <div class="uql-nav flex--item">
                        <div class="d-flex ai-center jc-space-between">
                            <div class="js-uql-navigation s-btn-group flex--item mr16 ff-row-nowrap">
                                <a class="s-btn s-btn__muted s-btn__outlined s-btn__sm d-flex" data-nav-value="Newest" href="{% url 'qa:questions' %}" data-shortcut="N">
                                    <div class="flex--item">Newest</div>
                                </a>
                                {% if query == '' %}
                                <a class="s-btn s-btn__muted s-btn__outlined s-btn__sm d-flex" data-nav-value="Active" href="{% url 'qa:activeQuestions' query=None %}" data-shortcut="A">
                                    <div class="flex--item">Active</div>
                                </a>
                                {% else %}
                                <a class="s-btn s-btn__muted s-btn__outlined s-btn__sm d-flex" data-nav-value="Active" href="{% url 'qa:activeQuestions' query %}" data-shortcut="A">
                                    <div class="flex--item">Active</div>
                                </a>
                                {% endif %}
                                {% if query == '' %}
                                <a class="s-btn s-btn__muted s-btn__outlined s-btn__sm d-flex uql-nav--expanded-item" data-nav-value="Bounties" href="{% url 'qa:BountiedQuestions' query=None %}" data-shortcut="E">
                                    <div class="flex--item">Bountied</div>
                                    <div class="s-badge s-badge__bounty s-badge__bounty s-badge__sm lh-xs ml4 px4 flex--item">{{count_bounty}}</div>
                                </a>
                                {% else %}
                                <a class="s-btn s-btn__muted s-btn__outlined s-btn__sm d-flex uql-nav--expanded-item" data-nav-value="Bounties" href="{% url 'qa:BountiedQuestions' query %}" data-shortcut="E">
                                    <div class="flex--item">Bountied</div>
                                    <div class="s-badge s-badge__bounty s-badge__bounty s-badge__sm lh-xs ml4 px4 flex--item">{{count_bounty}}</div>
                                </a>
                                {% endif %}
                                {% if query == '' %}
                                <a class="s-btn s-btn__muted s-btn__outlined s-btn__sm d-flex uql-nav--expanded-item is-selected" data-nav-value="Unanswered" href="{% url 'qa:unansweredQuestions' query=None %}">
                                    <div class="flex--item">Unanswered</div>
                                </a>
                                {% else %}
                                <a class="s-btn s-btn__muted s-btn__outlined s-btn__sm d-flex uql-nav--expanded-item is-selected" data-nav-value="Unanswered" href="{% url 'qa:unansweredQuestions' query %}">
                                    <div class="flex--item">Unanswered</div>
                                </a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <div id="questions" class="flush-left">
                    {% for question in questions %}
                    <div class="question-summary" id="question-summary-{{question.id}}">
                        <div class="statscontainer">
                            <div class="stats">
                                <div class="{% if question.is_answer_accepted %}status answered-accepted{% endif %}">
                                    <div class="votes">
                                        <span class="vote-count-post"><strong>{{question.calculate_UpVote_DownVote}}</strong></span>
                                        <div class="viewcount">vote{{question.calculate_UpVote_DownVote|pluralize}}</div>
                                    </div>
                                </div>
                                <div class="status {% if question.is_answer_accepted %}answered-accepted{% elif question.answer_set.all %}answered{% else %}unanswered{% endif %}">
                                    <strong>{{question.count_answers}}</strong>answer{{question.count_answers|pluralize}}
                                </div>
                            </div>
                            <div class="views" title="{{question.calculate_viewers}} view{{question.calculate_viewers|pluralize}}">{{question.calculate_viewers}} view{{question.calculate_viewers|pluralize}}</div>
                        </div>

                        <div class="summary">
                            <h3><a href="{{question.get_absolute_url}}" class="question-hyperlink">{{question.title}}</a></h3>
                            <div class="excerpt">
                                {{question.body|truncatechars:200}}
                            </div>

                            <div class="d-flex ai-start fw-wrap">
                                <div class="flex--item">
                                    <div class="d-flex gs4 fw-wrap tags">
                                        {% for tag in question.get_all_tags %}
                                        <a href="{% url 'tagbadge:taggedItemsFrom_All' tag.id %}" class="post-tag flex--item" title="show questions tagged '{{tag}}'" rel="{{tag}}">{{tag}}</a>
                                        {% endfor %}
                                    </div>
                                </div>
                                <div class="flex--item ml-auto fl-shrink0 started mt0">
                                    <div class="user-info d-flex ai-center">
                                        <div class="user-gravatar32" style="width: 24px; height: 24px; border-radius: 50%; overflow: hidden; margin-right: 8px;">
                                            <a href="{{question.post_owner.profile.get_absolute_url}}">
                                                <img src="{% if question.post_owner.profile.profile_photo %}{{question.post_owner.profile.profile_photo.url}}{% else %}{% static 'default.jpg' %}{% endif %}" 
                                                     alt="" 
                                                     width="24" 
                                                     height="24" 
                                                     style="object-fit: cover; width: 100%; height: 100%;"
                                                     onerror="this.onerror=null; this.src='{% static 'default.jpg' %}'">
                                            </a>
                                        </div>
                                        <div class="user-details">
                                            <div class="d-flex ai-center" style="gap: 4px; flex-wrap: wrap; font-size: 13px; line-height: 1.2;">
                                                <a href="{{question.post_owner.profile.get_absolute_url}}" 
                                                   style="color: #000000; font-weight: 500; text-decoration: none;">
                                                    {% if question.post_owner.profile.full_name %}
                                                        {{ question.post_owner.profile.full_name }}
                                                    {% else %}
                                                        {{ question.post_owner }}
                                                    {% endif %}
                                                </a>
                                                <span style="color: #6c757d; white-space: nowrap;">
                                                    asked <time title="{{question.q_edited_time}}" 
                                                              class="relativetime" 
                                                              style="font-weight: 500;">
                                                        {{question.q_edited_time|naturaltime}}
                                                    </time>
                                                </span>
                                            </div>
                                            <div class="d-flex ai-center" style="gap: 4px; margin-top: 2px; flex-wrap: wrap;">
                                                <span class="reputation-score" 
                                                      title="reputation score" 
                                                      style="font-weight: 600; color: #525960; font-size: 11px;">
                                                    {{question.post_owner|calculate_reputation}}
                                                </span>
                                                {% if question.post_owner|calculateGoldBadges %}
                                                    <span title="{{question.post_owner|calculateGoldBadges}} gold badge{{ question.post_owner|calculateGoldBadges|pluralize }}" 
                                                          style="color: #FFCC01; font-size: 11px; display: inline-flex; align-items: center;">
                                                        <i class="fas fa-medal"></i>
                                                        <span style="margin-left: 1px;">{{question.post_owner|calculateGoldBadges}}</span>
                                                    </span>
                                                {% endif %}
                                                {% if question.post_owner|calculatSilvereBadges %}
                                                    <span title="{{question.post_owner|calculatSilvereBadges}} silver badge{{ question.post_owner|calculatSilvereBadges|pluralize }}" 
                                                          style="color: #C0C0C0; font-size: 11px; display: inline-flex; align-items: center;">
                                                        <i class="fas fa-medal"></i>
                                                        <span style="margin-left: 1px;">{{question.post_owner|calculatSilvereBadges}}</span>
                                                    </span>
                                                {% endif %}
                                                {% if question.post_owner|calculateBronzeBadges %}
                                                    <span title="{{question.post_owner|calculateBronzeBadges}} bronze badge{{ question.post_owner|calculateBronzeBadges|pluralize }}" 
                                                          style="color: #CD7F32; font-size: 11px; display: inline-flex; align-items: center;">
                                                        <i class="fas fa-medal"></i>
                                                        <span style="margin-left: 1px;">{{question.post_owner|calculateBronzeBadges}}</span>
                                                    </span>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>

                <div class="s-pagination site1 themed pager float-left">
                    {% if questions.has_other_pages %}
                        {% for i in questions.paginator.page_range %}
                          {% if questions.number == i %}
                        <div class="s-pagination--item is-selected">{{ i }}</div>
                          {% else %}
                        <a class="s-pagination--item js-pagination-item" href="?page={{ i }}" rel="" title="Go to page {{ i }}">{{ i }}</a>
                          {% endif %}
                        {% endfor %}
                    {% endif %}
                </div>

            </div>

        </div>
    </div>
</div>
{% endblock content %}
