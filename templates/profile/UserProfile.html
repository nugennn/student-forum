{% extends 'profile/base.html' %}
{% load humanize %}
{% load static %}
{% load qa_tags %}

{% block css %}
<link href="{% static 'profile/css/summary.css' %}" type="text/css" media="all" rel="stylesheet" />
<link href="{% static 'profile/css/badge.css' %}" type="text/css" media="all" rel="stylesheet" />
<style>
    /* Prevent horizontal scroll globally */
    html, body {
        max-width: 100%;
        overflow-x: hidden;
    }

    .logo-name {
        padding: 8px;
        color: #568;
        border: 1px solid white;
        font-family: 'Nexa';
        font-weight: 500;
        font-style: normal;
    }
    .earned { color: green; }
    .container { max-width: 1400px; width: 100%; margin: 0 auto; padding: 0 24px; box-sizing: border-box; }
    
    /* Enhanced Styling */
    .user-show-new {
        background: #fff;
        border-radius: 8px;
        padding: 24px;
    }
    
    .profile-cards {
        gap: 20px !important;
    }
    
    .s-card {
        border-radius: 8px;
        border: 1px solid #e1e4e8;
        padding: 20px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        transition: all 0.3s ease;
    }
    
    .s-card:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .s-navigation {
        border-bottom: 2px solid #e1e4e8;
        margin-bottom: 24px;
        padding-bottom: 12px;
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
    }
    
    .s-navigation--item {
        padding: 8px 16px;
        border-radius: 4px;
        font-size: 14px;
        font-weight: 500;
        color: #666;
        text-decoration: none;
        transition: all 0.2s ease;
        cursor: pointer;
        border: 1px solid transparent;
    }
    
    .s-navigation--item:hover {
        background: #f5f5f5;
        color: #333;
    }
    
    .s-navigation--item.is-selected {
        background: #0a95ff;
        color: white;
        border-color: #0a95ff;
    }
    
    .tab-pane {
        animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    .user-panel {
        background: #f9f9f9;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        border: 1px solid #e1e4e8;
    }
    
    .profile-section-title {
        font-size: 18px;
        font-weight: 600;
        color: #333;
        margin: 0 0 16px 0;
        padding-bottom: 12px;
        border-bottom: 2px solid #0a95ff;
        display: inline-block;
    }
    
    .user-panel-content {
        padding: 12px 0;
    }
    
    .user-questions, .user-answers, .user-rep, .user-tags {
        width: 100%;
        border-collapse: collapse;
    }
    
    .user-questions tr, .user-answers tr, .user-rep tr {
        border-bottom: 1px solid #e1e4e8;
        transition: background 0.2s ease;
    }
    
    .user-questions tr:hover, .user-answers tr:hover, .user-rep tr:hover {
        background: #f5f5f5;
    }
    
    .user-questions td, .user-answers td, .user-rep td {
        padding: 12px 8px;
    }
    
    .count-cell {
        width: 80px;
        text-align: center;
        font-weight: 600;
    }
    
    .mini-counts {
        background: #e1f5ff;
        color: #0a95ff;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 13px;
        font-weight: 600;
    }
    
    .mini-counts.answered-accepted {
        background: #d4edda;
        color: #155724;
    }
    
    .question-hyperlink, .answer-hyperlink {
        color: #0a95ff;
        text-decoration: none;
        font-weight: 500;
    }
    
    .question-hyperlink:hover, .answer-hyperlink:hover {
        color: #0969da;
        text-decoration: underline;
    }
    
    .rep-up {
        color: #28a745;
        font-weight: 600;
    }
    
    .rep-down {
        color: #dc3545;
        font-weight: 600;
    }
    
    .empty {
        text-align: center;
        color: #999;
        padding: 20px;
        font-style: italic;
    }
    
    .post-tag {
        display: inline-block;
        background: #e1f5ff;
        color: #0a95ff;
        padding: 4px 8px;
        border-radius: 4px;
        text-decoration: none;
        font-size: 12px;
        font-weight: 500;
        margin: 4px;
    }
    
    .post-tag:hover {
        background: #0a95ff;
        color: white;
    }
    
    .item-multiplier {
        font-size: 12px;
        color: #999;
        margin-left: 4px;
    }
    
    .summary-stat {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 0;
        border-bottom: 1px solid #e1e4e8;
    }
    
    .summary-stat:last-child {
        border-bottom: none;
    }
    
    .summary-label {
        color: #666;
        font-weight: 500;
    }
    
    .summary-value {
        font-size: 20px;
        font-weight: 700;
        color: #0a95ff;
    }
    
    .badge-display {
        display: flex;
        gap: 16px;
        justify-content: space-around;
    }
    
    .badge-item {
        text-align: center;
    }
    
    .badge-count {
        font-size: 24px;
        font-weight: 700;
        color: #0a95ff;
    }
    
    .badge-label {
        font-size: 12px;
        color: #666;
        margin-top: 4px;
    }
    
    /* Profile Cards Enhancements - Compact */
    .profile-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 16px;
        width: 100%;
        overflow: hidden;
        box-sizing: border-box;
    }
    
    .profile-cards .s-card {
        background: #ffffff;
        border: 1px solid #e1e4e8;
        padding: 16px;
        min-height: auto;
        display: flex;
        flex-direction: column;
    }
    
    .profile-cards .s-card h1 {
        font-size: 14px;
        font-weight: 600;
        color: #0a95ff;
        margin: 0 0 12px 0;
        padding-bottom: 8px;
        border-bottom: 1px solid #e1e4e8;
        display: flex;
        align-items: center;
        gap: 6px;
    }
    
    .reputation-value {
        font-size: 32px;
        font-weight: 700;
        color: #0a95ff;
        text-align: center;
        margin: 8px 0;
    }
    
    .chart-container {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100px;
        margin: 8px 0;
    }
    
    .chart-container canvas {
        max-width: 100% !important;
        height: auto !important;
    }
    
    .badge-section {
        margin-bottom: 8px;
    }
    
    .badge-row {
        display: flex;
        justify-content: space-around;
        gap: 8px;
        margin-bottom: 8px;
    }
    
    .badge-box {
        flex: 1;
        text-align: center;
        padding: 8px;
        border-radius: 4px;
        background: #f9f9f9;
        border: 1px solid #e1e4e8;
    }
    
    .badge-box-count {
        font-size: 20px;
        font-weight: 700;
        margin: 4px 0;
    }
    
    .badge-box-label {
        font-size: 11px;
        color: #666;
        font-weight: 500;
    }
    
    .newest-badge-section {
        background: #f9f9f9;
        padding: 8px;
        border-radius: 4px;
        margin-bottom: 8px;
    }
    
    .newest-badge-label {
        font-size: 10px;
        color: #999;
        text-transform: uppercase;
        font-weight: 600;
        margin-bottom: 2px;
    }
    
    .newest-badge-name {
        font-size: 12px;
        color: #0a95ff;
        font-weight: 600;
    }
    
    .impact-stat {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 6px 0;
        border-bottom: 1px solid #f0f0f0;
    }
    
    .impact-stat:last-child {
        border-bottom: none;
    }
    
    .impact-stat-label {
        font-size: 12px;
        color: #666;
        display: flex;
        align-items: center;
        gap: 6px;
    }
    
    .impact-stat-value {
        font-size: 14px;
        font-weight: 700;
        color: #0a95ff;
    }
    
    .impact-number {
        font-size: 24px;
        font-weight: 700;
        color: #0a95ff;
        text-align: center;
        margin: 8px 0;
    }
    
    .impact-description {
        font-size: 11px;
        color: #666;
        text-align: center;
    }
    
    /* Profile Header Styling */
    .profile-header {
        background: #ffffff;
        border-bottom: 1px solid #e1e4e8;
        padding: 20px 0;
        margin-bottom: 24px;
    }
    
    .profile-header-top {
        display: flex;
        align-items: flex-start;
        gap: 20px;
    }
    
    .profile-avatar {
        flex-shrink: 0;
    }
    
    .profile-avatar img {
        width: 96px;
        height: 96px;
        border-radius: 8px;
        border: 2px solid #e1e4e8;
        object-fit: cover;
    }
    
    .profile-info {
        flex: 1;
    }
    
    .profile-name {
        font-size: 28px;
        font-weight: 700;
        color: #333;
        margin: 0 0 4px 0;
    }
    
    .profile-title {
        font-size: 14px;
        color: #666;
        margin: 0 0 12px 0;
        font-weight: 500;
    }
    
    .profile-meta {
        display: flex;
        gap: 16px;
        margin-bottom: 12px;
        flex-wrap: wrap;
    }
    
    .meta-item {
        font-size: 13px;
        color: #666;
    }
    
    .profile-links {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
    }
    
    .link-item {
        font-size: 13px;
        color: #0a95ff;
        text-decoration: none;
        padding: 4px 8px;
        border-radius: 4px;
        background: #f0f7ff;
        transition: all 0.2s ease;
    }
    
    .link-item:hover {
        background: #e1f0ff;
        color: #0969da;
    }
    
    .profile-actions {
        flex-shrink: 0;
    }
    
    .btn-edit {
        display: inline-block;
        padding: 10px 18px;
        background: #0a95ff;
        color: #ffffff;
        border-radius: 6px;
        text-decoration: none;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.2s ease;
        border: none;
        cursor: pointer;
        box-shadow: 0 1px 3px rgba(10, 149, 255, 0.2);
    }
    
    .btn-edit:hover {
        background: #0969da;
        box-shadow: 0 2px 6px rgba(9, 105, 218, 0.3);
    }
</style>
{% endblock css %}

{% block content %}
<div class="container">
    <div id="mainbar-full" class="user-show-new">

        <!-- Profile Header -->
        <div class="profile-header">
            <div class="profile-header-top">
                <div class="profile-avatar">
                    <img src="{% if profileData.profile_photo %}{{ profileData.profile_photo.url }}{% endif %}" alt="{{ profileData.user }}" width="96" height="96">
                </div>
                <div class="profile-info">
                    <h1 class="profile-name d-inline-block">{{ profileData.user }}</h1>
                    {% if request.user.is_authenticated and request.user != profileData.user %}
                    <a href="{% url 'chat:private_chat' profileData.user.id %}" 
                       role="button" 
                       class="btn btn-outline-primary ms-3 align-middle d-inline-flex align-items-center"
                       style="font-size:1.05rem; padding:.5rem .75rem; gap:.5rem;">
                        <i class="fas fa-comment" style="font-size:1.2rem;"></i>
                        <span class="ms-1 fw-semibold">Chat</span>
                    </a>
                    {% endif %}
                    <p class="profile-title">{{ profileData.title }}</p>
                    <div class="profile-meta">
                        <span class="meta-item">üìÖ Joined {{ profileData.user.date_joined|naturaltime }}</span>
                        {% if not profileData.is_high_moderator %}
                        <span class="meta-item">üëÅÔ∏è Last seen {{ online_user_activity.last_activity|naturaltime }}</span>
                        {% endif %}
                    </div>
                    <div class="profile-links">
                        {% if profileData.twitter_link %}<a href="{{ profileData.twitter_link }}" class="link-item">üê¶ Twitter</a>{% endif %}
                        {% if profileData.github_link %}<a href="{{ profileData.github_link }}" class="link-item">üêô GitHub</a>{% endif %}
                        {% if profileData.website_link %}<a href="{{ profileData.website_link }}" class="link-item">üîó Website</a>{% endif %}
                        {% if profileData.location %}<span class="link-item">üìç {{ profileData.location }}</span>{% endif %}
                    </div>
                </div>
                {% if request.user == profileData.user %}
                <div class="profile-actions">
                    <a class="btn-edit" href="{% url 'profile:userProfileEdit_Settings' profileData.id %}">Edit profile</a>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Navigation tabs -->
        <div class="d-flex ai-center jc-space-between fw-wrap mb16 js-user-header">
            <div class="flex--item s-navigation">
                <a href="{% url 'profile:activityPageTabProfile' profileData.user.id profileData.user.username %}" class="s-navigation--item" data-shortcut="P">Profile</a>
                <a href="{% url 'profile:ActivityTabSummary' profileData.user.id profileData.user.username %}" class="s-navigation--item is-selected" data-shortcut="A">Activity</a>
                {% if request.user == profileData.user %}
                <a href="{% url 'profile:userProfileEdit_Settings' profileData.user.id %}" class="s-navigation--item">Settings</a>
                {% endif %}
            </div>
            <div class="flex--item ml-auto"><div class="s-navigation s-navigation__muted ai-center"></div></div>
        </div>

        <!-- Profile summary cards -->
        <div class="mb32">
            <div id="top-cards" class="d-flex gs16 profile-cards">
                <!-- Reputation -->
                <aside class="flex--item fl1 wmx4 s-card bg-black-025">
                    <div class="d-flex fd-column h100">
                        <h1 class="flex--item fs-category fs-fine fc-black-350">‚≠ê Reputation</h1>
                        <div class="reputation-value">{{ request.user|calculate_reputation }}</div>
                        <div class="chart-container">
                            <canvas id="myChart"></canvas>
                        </div>
                    </div>
                </aside>
                <!-- Badges -->
                <aside class="flex--item fl1 wmx4 s-card bg-black-025 bc-black-075 c-auto js-highlight-box-badges">
                    <div class="d-flex fd-column h100">
                        <h1 class="flex--item fs-category fs-fine fc-black-350">üèÜ Badges</h1>
                        <div class="badge-section">
                            <div class="badge-row">
                                <div class="badge-box">
                                    <div style="font-size: 18px;">ü•á</div>
                                    <div class="badge-box-count" style="color: #FFD700;">{{ profileData.user|calculateGoldBadges }}</div>
                                    <div class="badge-box-label">Gold</div>
                                </div>
                                <div class="badge-box">
                                    <div style="font-size: 18px;">ü•à</div>
                                    <div class="badge-box-count" style="color: #C0C0C0;">{{ profileData.user|calculatSilvereBadges }}</div>
                                    <div class="badge-box-label">Silver</div>
                                </div>
                                <div class="badge-box">
                                    <div style="font-size: 18px;">ü•â</div>
                                    <div class="badge-box-count" style="color: #CD7F32;">{{ profileData.user|calculateBronzeBadges }}</div>
                                    <div class="badge-box-label">Bronze</div>
                                </div>
                            </div>
                        </div>
                        <div class="newest-badge-section">
                            <div class="newest-badge-label">Latest</div>
                            <div class="newest-badge-name">{{ newestBadge.tag_name|default:"‚Äî" }}</div>
                        </div>
                    </div>
                </aside>
                <!-- Impact -->
                <aside class="flex--item wmn2 s-card bg-black-025 bc-black-075 c-auto">
                    <div class="d-flex fd-column h100">
                        <h1 class="flex--item fs-category fs-fine fc-black-350">üìä Impact</h1>
                        <div class="impact-stat">
                            <span class="impact-stat-label">üë• Reach</span>
                            <span class="impact-stat-value">~{{ getAllTheViewsOfAllTheQuestion.total_views__sum|default:"0" }}</span>
                        </div>
                        <div class="impact-stat">
                            <span class="impact-stat-label">‚úèÔ∏è Edits</span>
                            <span class="impact-stat-value">{{ profileData.posts_edited_counter }}</span>
                        </div>
                        <div class="impact-stat">
                            <span class="impact-stat-label">üö© Flags</span>
                            <span class="impact-stat-value">
                                {% if request.user == profileData.user %}
                                <a href="{% url 'profile:flag_summary' profileData.user.id profileData.user.username %}" style="color: #0a95ff; text-decoration: none;">{{ profileData.helpful_flags_counter }}</a>
                                {% else %}
                                {{ profileData.helpful_flags_counter }}
                                {% endif %}
                            </span>
                        </div>
                        <div class="impact-stat">
                            <span class="impact-stat-label">üó≥Ô∏è Votes</span>
                            <span class="impact-stat-value">
                                {% if request.user == profileData.user %}
                                <a href="{% url 'profile:Votes_castActivity' profileData.user.id profileData.user.username %}" style="color: #0a95ff; text-decoration: none;">{{ getVotesCast_Final }}</a>
                                {% else %}
                                {{ getVotesCast_Final }}
                                {% endif %}
                            </span>
                        </div>
                    </div>
                </aside>
            </div>
        </div>

        <!-- Navigation Section -->
        <div class="s-navigation s-navigation__muted s-navigation__sm">
            <a class="s-navigation--item is-selected tab-link" href="#summary" data-tab="summary" title="Your overall summary">Summary</a>
            <a class="s-navigation--item tab-link" href="#answers" data-tab="answers" title="Answers you provided">Answers</a>
            <a class="s-navigation--item tab-link" href="#questions" data-tab="questions" title="Questions you asked">Questions</a>
            <a class="s-navigation--item tab-link" href="#tags" data-tab="tags" title="Tags you have posts in">Tags</a>
            <a class="s-navigation--item tab-link" href="#badges" data-tab="badges" title="Badges you have earned">Badges</a>
            <a class="s-navigation--item tab-link" href="#bookmarks" data-tab="bookmarks" title="Questions you have bookmarked">
                <span class="s-badge s-badge__bounty s-badge__sm lh-xs mr2">{{ profileData.user.id|count_all_bookmarkers }}</span>
                Bookmarks
            </a>
            <a class="s-navigation--item tab-link" href="#bounties" data-tab="bounties" title="Bounties you have participated in">Bounties</a>
            <a class="s-navigation--item tab-link" href="#reputation" data-tab="reputation" title="Reputation you have earned">Reputation</a>
            <a class="s-navigation--item tab-link" href="#allactions" data-tab="allactions" title="Your recent actions">All actions</a>
            {% if profileData.user == request.user %}
            <a class="s-navigation--item tab-link" href="#votes" data-tab="votes" title="Votes you have cast">Votes</a>
            {% endif %}
        </div>

        <!-- Tab Content Panels -->
        <div id="tab-content">
            <!-- Summary Tab (default) -->
            <div id="summary" class="tab-pane active">
                <div class="user-panel">
                    <h3 class="profile-section-title">üìä Activity Summary</h3>
                    <div class="user-panel-content">
                        <div class="summary-stat">
                            <span class="summary-label">üìù Total Questions Asked</span>
                            <span class="summary-value">{{ questionsCount }}</span>
                        </div>
                        <div class="summary-stat">
                            <span class="summary-label">üí¨ Total Answers Provided</span>
                            <span class="summary-value">{{ answersCount }}</span>
                        </div>
                        <div class="summary-stat">
                            <span class="summary-label">‚≠ê Total Reputation</span>
                            <span class="summary-value">{{ finalReputation }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Questions Tab -->
            <div id="questions" class="tab-pane">
                <div id="user-panel-questions" class="user-panel">
                    <h3 class="profile-section-title">üìã Your Questions <span style="font-size: 14px; color: #0a95ff;">({{ questionsCount }})</span></h3>
                    <div class="user-panel-content">
                        {% if question_most_votes %}
                        <table class="user-questions lines">
                            <thead style="background: #f0f0f0; font-weight: 600; color: #333;">
                                <tr>
                                    <td class="count-cell">Votes</td>
                                    <td>Question Title</td>
                                </tr>
                            </thead>
                            <tbody>
                                {% for question in question_most_votes %}
                                <tr>
                                    <td class="count-cell"><div class="mini-counts {% if question.is_answer_accepted %}answered-accepted{% endif %}">{{ question.qupvote_set.count }}</div></td>
                                    <td class="question-hyperlink"><a href="{{ question.get_absolute_url }}" class="question-hyperlink">{{ question.title }}</a></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        {% else %}
                        <div class="empty">üì≠ You haven't asked any questions yet</div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Answers Tab -->
            <div id="answers" class="tab-pane">
                <div id="user-panel-answers" class="user-panel">
                    <h3 class="profile-section-title">üí° Your Answers <span style="font-size: 14px; color: #0a95ff;">({{ answersCount }})</span></h3>
                    <div class="user-panel-content">
                        {% if answersNewest %}
                        <table class="user-answers lines">
                            <thead style="background: #f0f0f0; font-weight: 600; color: #333;">
                                <tr>
                                    <td class="count-cell">Votes</td>
                                    <td>Answer Preview</td>
                                </tr>
                            </thead>
                            <tbody>
                                {% for answer in answersNewest %}
                                <tr>
                                    <td class="count-cell"><div class="mini-counts {% if answer.accepted %}answered-accepted{% endif %}">{{ answer.a_vote_ups.all.count }}</div></td>
                                    <td class="answer-hyperlink"><a href="{{ answer.questionans.get_absolute_url }}#{{ answer.id }}" class="answer-hyperlink">{{ answer.body|truncatechars:80 }}</a></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        {% else %}
                        <div class="empty">üì≠ You haven't answered any questions yet</div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Reputation Tab -->
            <div id="reputation" class="tab-pane">
                <div id="user-panel-reputation" class="user-panel">
                    <h3 class="profile-section-title">üìà Reputation History <span style="font-size: 14px; color: #0a95ff;">({{ finalReputation }})</span></h3>
                    <div class="user-panel-content">
                        {% if reputations %}
                        <table class="user-rep lines">
                            <thead style="background: #f0f0f0; font-weight: 600; color: #333;">
                                <tr>
                                    <td class="count-cell">Change</td>
                                    <td>Source</td>
                                </tr>
                            </thead>
                            <tbody>
                                {% for rep in reputations %}
                                {% if rep.answer_O %}
                                <tr>
                                    <td class="rep-amount count-cell">{% if rep.inc_dec == "Increased" %}<span class="rep-up">+{{ rep.answer_rep_C }}</span>{% else %}<span class="rep-down">-{{ rep.answer_rep_C }}</span>{% endif %}</td>
                                    <td><a href="{{ rep.answer_O.questionans.get_absolute_url }}#{{ rep.answer_O.id }}" class="question-hyperlink">{{ rep.answer_O.body|truncatechars:70 }}</a></td>
                                </tr>
                                {% else %}
                                <tr>
                                    <td class="rep-amount count-cell">{% if rep.inc_dec == "Increased" %}<span class="rep-up">+{{ rep.question_rep_C }}</span>{% else %}<span class="rep-down">-{{ rep.question_rep_C }}</span>{% endif %}</td>
                                    <td><a href="{{ rep.question_O.get_absolute_url }}" class="question-hyperlink">{{ rep.question_O.body|truncatechars:70 }}</a></td>
                                </tr>
                                {% endif %}
                                {% endfor %}
                            </tbody>
                        </table>
                        {% else %}
                        <div class="empty">üì≠ No reputation changes yet</div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Tags Tab -->
            <div id="tags" class="tab-pane">
                <div id="user-panel-tags" class="user-panel">
                    <h3 class="profile-section-title">üè∑Ô∏è Your Tags <span style="font-size: 14px; color: #0a95ff;">({{ tags.count }})</span></h3>
                    <div class="user-panel-content">
                        {% if tags %}
                        <div style="display: flex; flex-wrap: wrap; gap: 8px; padding: 12px 0;">
                            {% for tag in tags %}
                            <div style="display: flex; align-items: center; gap: 4px;">
                                <a href="{% url 'tagbadge:taggedItemsFrom_All' tag.id %}" class="post-tag">{{ tag }}</a>
                                <span class="item-multiplier" title="Posts with this tag">√ó{{ tag.answeredOn }}</span>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="empty">üì≠ You haven't posted in any tags yet</div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Bookmarks Tab -->
            <div id="bookmarks" class="tab-pane">
                <div id="user-panel-bookmarks" class="user-panel">
                    <h3 class="profile-section-title">üîñ Bookmarked Questions <span style="font-size: 14px; color: #0a95ff;">({{ countBookmarks }})</span></h3>
                    <div class="user-panel-content">
                        {% if bookmarks_votes %}
                        <table class="user-questions lines">
                            <thead style="background: #f0f0f0; font-weight: 600; color: #333;">
                                <tr>
                                    <td class="count-cell">Votes</td>
                                    <td>Question</td>
                                </tr>
                            </thead>
                            <tbody>
                                {% for question in bookmarks_votes %}
                                <tr>
                                    <td class="count-cell"><div class="mini-counts {% if question.is_answer_accepted %}answered-accepted{% endif %}">{{ question.bookmarked_question.qupvote_set.count }}</div></td>
                                    <td class="question-hyperlink"><a href="{{ question.get_absolute_url }}" class="question-hyperlink">{{ question.bookmarked_question.title }}</a></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        {% else %}
                        <div class="empty">üì≠ You haven't bookmarked any questions yet</div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Badges Tab -->
            <div id="badges" class="tab-pane">
                <div class="user-panel">
                    <h3 class="profile-section-title">üèÜ Earned Badges</h3>
                    <div class="user-panel-content">
                        <div class="badge-display">
                            <div class="badge-item">
                                <div class="badge-count" style="color: #FFD700;">{{ profileData.user|calculateGoldBadges }}</div>
                                <div class="badge-label">ü•á Gold Badges</div>
                            </div>
                            <div class="badge-item">
                                <div class="badge-count" style="color: #C0C0C0;">{{ profileData.user|calculatSilvereBadges }}</div>
                                <div class="badge-label">ü•à Silver Badges</div>
                            </div>
                            <div class="badge-item">
                                <div class="badge-count" style="color: #CD7F32;">{{ profileData.user|calculateBronzeBadges }}</div>
                                <div class="badge-label">ü•â Bronze Badges</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bounties Tab -->
            <div id="bounties" class="tab-pane">
                <div class="user-panel">
                    <h3 class="profile-section-title">üí∞ Bounties</h3>
                    <div class="user-panel-content">
                        <div class="empty">üí° Bounty information will be displayed here when available</div>
                    </div>
                </div>
            </div>

            <!-- All Actions Tab -->
            <div id="allactions" class="tab-pane">
                <div class="user-panel">
                    <h3 class="profile-section-title">‚ö° Recent Actions</h3>
                    <div class="user-panel-content">
                        <div class="empty">üìã Your recent actions will be displayed here</div>
                    </div>
                </div>
            </div>

            <!-- Votes Tab (if user is logged in) -->
            {% if profileData.user == request.user %}
            <div id="votes" class="tab-pane">
                <div class="user-panel">
                    <h3 class="profile-section-title">üó≥Ô∏è Votes Cast</h3>
                    <div class="user-panel-content">
                        <div class="summary-stat">
                            <span class="summary-label">Total Votes Cast</span>
                            <span class="summary-value">{{ getVotesCast_Final }}</span>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>

    </div>
</div>

{% if request.user.is_authenticated %}
<!-- Badge selection modal -->
<div id="pop-Modal" class="modal-box">
    <div class="modal-content">
        <!-- Include your badge selection modal content here -->
    </div>
</div>
{% endif %}

<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
<script src="{% static 'config.js' %}"></script>
<script>
    // Tab switching functionality
    $(document).ready(function(){
        // Handle tab clicks
        $('.tab-link').on('click', function(e){
            e.preventDefault();
            var tabName = $(this).data('tab');
            
            // Hide all tabs
            $('.tab-pane').removeClass('active').hide();
            
            // Show selected tab
            $('#' + tabName).addClass('active').show();
            
            // Update active link
            $('.tab-link').removeClass('is-selected');
            $(this).addClass('is-selected');
            
            // Update URL hash without page reload
            window.history.pushState(null, null, '#' + tabName);
        });
        
        // Handle browser back/forward buttons
        $(window).on('hashchange', function(){
            var hash = window.location.hash.substr(1);
            if(hash) {
                $('.tab-pane').removeClass('active').hide();
                $('#' + hash).addClass('active').show();
                $('.tab-link').removeClass('is-selected');
                $('.tab-link[data-tab="' + hash + '"]').addClass('is-selected');
            }
        });
        
        // Initialize chart
        var ctx = document.getElementById('myChart');
        if(ctx) {
            var SHOW_DATE_or_reputation_or_what = "date";
            var show_this;
            if (SHOW_DATE_or_reputation_or_what == "reputation_on") {
                show_this = [{% for data in reputation_graph %}'{% if data.reputation_on_what == "QUESTION" %}Question{% elif data.reputation_on_what == "ANSWER" %}Answer{% elif data.reputation_on_what == "EDIT" %}Edit{% elif data.reputation_on_what == "ANSWER_ACCEPT" %}Answer Accepted{% endif %}',{% endfor %}]
            } else if (SHOW_DATE_or_reputation_or_what == "date") {
                show_this = [{% for data in reputation_graph %}'{{ data.date_earned|naturaltime }}',{% endfor %}]
            }
            
            var myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: show_this,
                    datasets: [{
                        label: "Reputation Chart",
                        fill: false,
                        data: [{% for data in reputation_graph %}{% if data.question_rep_C %}{{ data.question_rep_C }}{% else %}{{ data.answer_rep_C }}{% endif %},{% endfor %}],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 206, 86, 0.2)',
                            'rgba(75, 192, 192, 0.2)',
                            'rgba(153, 102, 255, 0.2)',
                            'rgba(255, 159, 64, 0.2)'
                        ],
                        borderColor: 'green',
                        borderWidth: 1
                    }]
                },
                options: { scales: { y: { beginAtZero: true } } }
            });
        }
    });
</script>
<style>
    .tab-pane { display: none; }
    .tab-pane.active { display: block; }
</style>
<script type="text/javascript" src="{% static 'profile/js/summary.js' %}"></script>
<script type="text/javascript" src="{% static 'profile/js/badge.js' %}"></script>
{% endblock content %}